---
title: 流程记录脚本
date: 2021-08-27 09:27:26
readmore: true
tags:  
	- JAVA
	- 脚本
    
categories:
  -JAVA学习
  
---
写一个对表单流程实现数据备份的脚本。当然具体的底层就不方便写了。
<!-- more -->
## 脚本实现
````java
    //注入容器，继承底层IScript接口。
    @Component
    public class YgbScript implements IScript {
        @Resource
        private YgbManagerImpl ygbManager;
        public void qjScript(ActionCmd cmd) {
            SimpleDateFormat format=new SimpleDateFormat("yyyy-MM-dd");
            //把流程表单中的值赋给data
            String data=cmd.getBusData();
            //dataMap是表和数据的键值对
            Map<String,Object> dataMap=(Map<String, Object>) JSON.parse(data);
            //这里是取出指定表的列和数据的键值对.
            Map<String,Object> map=(Map<String,Object>) dataMap.get("YGQJBDX_431300_DX");
            //ID在底层是自动生成的,这里手动取出ID
            String ID=cmd.getInstId();
            //根据key取数据
            String QJ_STARTTIME=(String) map.get("QJ_STARTTIME");
            String QJ_ENDTIME =(String) map.get("QJ_ENDTIME");
            //转换数据类型为date类
            Date STARTTIME= null;
            Date  ENDTIME= null;
            try
            {
                STARTTIME = format.parse(QJ_STARTTIME);
                ENDTIME = format.parse(QJ_ENDTIME);
            }
            catch (ParseException e)
            {
                e.printStackTrace();
            }
            //取数据
            String NAME=(String) map.get("NAME");
            String SEX=(String) map.get("SEX");
            String DEPARTMENT=(String)map.get("DEPARTMENT");
            String QJ_TYPE=(String) map.get("QJ_TYPE");
            int QJ_DATECOUNT=(int) map.get("QJ_DATECOUNT");
            String QJ_FZRYJ=(String)map.get("QJ_FZRYJ");
            String QJ_FZR=(String)map.get("QJ_FZR");
            String QJ_RSYJ=(String)map.get("QJ_RSYJ");
            String QJ_RSFZR=(String)map.get("QJ_RSFZR");
            
            
            YGB ygb=new YGB();
            ygb.setID(ID);
            ygb.setNAME(NAME);
            ygb.setDEPARTMENT(DEPARTMENT);
            ygb.setSEX(SEX);
            ygb.setQJ_TYPE(QJ_TYPE);
            ygb.setQJ_STARTTIME(STARTTIME);
            ygb.setQJ_ENDTIME(ENDTIME);
            ygb.setQJ_DATECOUNT(QJ_DATECOUNT);
            ygb.setQJ_FZRYJ(QJ_FZRYJ);
            ygb.setQJ_FZR(QJ_FZR);
            ygb.setQJ_RSYJ(QJ_RSYJ);
            ygb.setQJ_RSFZR(QJ_RSFZR);
            //调用server层,通过server层再调用Dao层
            ygbManager.YGB2(ygb);
        }
    
    }
````
## Dao层
````java
    @Repository
    public class YgbDaoImpl extends MyBatisDaoImpl implements YgbDAO {
        //利用jdbc调用数据库
        @Resource
        private JdbcTemplate jdbcTemplate;
        //数据源
        static String SJY_NAME="LSY_GOVENGINE_LAND";
    
        //重写getNamespace方法
        @Override
        public String getNamespace() {
    
            return YgbDaoImpl.class.getName();
        }
    
        @Override
        public void YGB2(YGB ygb) {
            String sql="insert into OA_YGQJB2 VALUES(?,?,?,?,?,?,?,?,?,?,?,?)";
            try
            {
                jdbcTemplate= DataSourceUtil.getJdbcTempByDsAlias(SJY_NAME);
                jdbcTemplate.update(sql,new Object[]{ygb.getID(),ygb.getNAME(),ygb.getSEX(),ygb.getDEPARTMENT(),ygb.getQJ_TYPE(),ygb.getQJ_STARTTIME(),ygb.getQJ_ENDTIME(),ygb.getQJ_DATECOUNT(),ygb.getQJ_FZRYJ(),ygb.getQJ_FZR(),ygb.getQJ_RSYJ(),ygb.getQJ_RSFZR()});
            }
            catch (Exception e)
            {
                e.printStackTrace();
            }
        }
    }
````